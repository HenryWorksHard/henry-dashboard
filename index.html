<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0d1117">
  <link rel="manifest" href="manifest.json">
  <title>Henry Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0d1117;
      min-height: 100vh;
      color: #c9d1d9;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 60px;
      background: #161b22;
      border-right: 1px solid #30363d;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
      gap: 1.5rem;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
    }

    .sidebar-logo {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      font-size: 1rem;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .nav-item {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8b949e;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-item:hover, .nav-item.active {
      background: #21262d;
      color: #c9d1d9;
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
    }

    /* Main Content */
    .main {
      flex: 1;
      padding: 1.5rem 2rem;
      overflow-y: auto;
      margin-left: 60px;
    }

    .header {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #30363d;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #f0f6fc;
    }

    .status-badge {
      background: #238636;
      color: #fff;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .header-right {
      color: #8b949e;
      font-size: 0.75rem;
    }

    /* Current Task Banner */
    .current-task-banner {
      background: linear-gradient(135deg, rgba(88, 166, 255, 0.1) 0%, rgba(56, 139, 253, 0.1) 100%);
      border: 1px solid rgba(88, 166, 255, 0.4);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .current-task-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #58a6ff, #388bfd);
    }

    .current-task-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #58a6ff;
      margin-bottom: 0.5rem;
    }

    .current-task-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #f0f6fc;
      margin-bottom: 0.25rem;
    }

    .current-task-desc {
      font-size: 0.875rem;
      color: #8b949e;
      margin-bottom: 0.75rem;
    }

    .current-task-progress {
      font-size: 0.8rem;
      color: #58a6ff;
      background: rgba(88, 166, 255, 0.1);
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      display: inline-block;
    }

    .no-current-task {
      color: #8b949e;
      font-size: 0.875rem;
    }

    /* Paused State */
    .current-task-banner.paused {
      background: linear-gradient(135deg, rgba(210, 153, 34, 0.1) 0%, rgba(210, 153, 34, 0.05) 100%);
      border-color: rgba(210, 153, 34, 0.4);
    }

    .current-task-banner.paused::before {
      background: #d29922;
      animation: none;
    }

    .current-task-banner.paused .current-task-label {
      color: #d29922;
    }

    .paused-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      background: rgba(210, 153, 34, 0.15);
      color: #d29922;
      padding: 0.25rem 0.625rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-left: 0.5rem;
    }

    .paused-badge svg {
      width: 12px;
      height: 12px;
    }

    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    @media (max-width: 1200px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      .sidebar { display: none; }
      .main { margin-left: 0; }
    }

    /* Cards */
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 1.25rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #f0f6fc;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
      color: #8b949e;
    }

    .card-actions svg {
      width: 16px;
      height: 16px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .card-actions svg:hover {
      color: #c9d1d9;
    }

    /* Next Task Card */
    .next-task-item {
      background: #21262d;
      border-radius: 6px;
      padding: 1rem;
    }

    .next-task-title {
      font-weight: 500;
      color: #f0f6fc;
      margin-bottom: 0.25rem;
    }

    .next-task-desc {
      font-size: 0.8rem;
      color: #8b949e;
      margin-bottom: 0.5rem;
    }

    .next-task-meta {
      display: flex;
      gap: 0.75rem;
      font-size: 0.75rem;
    }

    .meta-tag {
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: rgba(139, 148, 158, 0.1);
      color: #8b949e;
    }

    .meta-tag.high { background: rgba(248, 81, 73, 0.15); color: #f85149; }
    .meta-tag.medium { background: rgba(210, 153, 34, 0.15); color: #d29922; }
    .meta-tag.low { background: rgba(63, 185, 80, 0.15); color: #3fb950; }

    /* Recurring Tasks */
    .recurring-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .recurring-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: #21262d;
      border-radius: 6px;
    }

    .recurring-icon {
      width: 36px;
      height: 36px;
      border-radius: 6px;
      background: rgba(136, 46, 224, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .recurring-icon svg {
      width: 18px;
      height: 18px;
      color: #a371f7;
    }

    .recurring-info {
      flex: 1;
    }

    .recurring-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #f0f6fc;
    }

    .recurring-desc {
      font-size: 0.75rem;
      color: #8b949e;
    }

    .recurring-badge {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      background: rgba(163, 113, 247, 0.15);
      color: #a371f7;
    }

    /* Recommendations */
    .rec-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .rec-item {
      padding: 0.875rem;
      border-left: 3px solid #58a6ff;
      background: rgba(88, 166, 255, 0.05);
      border-radius: 0 6px 6px 0;
    }

    .rec-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #f0f6fc;
      margin-bottom: 0.25rem;
    }

    .rec-desc {
      font-size: 0.8rem;
      color: #8b949e;
      line-height: 1.4;
    }

    .rec-category {
      display: inline-block;
      margin-top: 0.5rem;
      font-size: 0.65rem;
      text-transform: uppercase;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      background: rgba(139, 148, 158, 0.1);
      color: #8b949e;
    }

    /* Task List */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .task-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: #21262d;
      border-radius: 6px;
      font-size: 0.875rem;
    }

    .task-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .task-status.completed { background: #3fb950; }
    .task-status.in_progress, .task-status.in-progress { background: #58a6ff; }
    .task-status.pending { background: #8b949e; }
    .task-status.overdue { background: #f85149; }

    .task-name { flex: 1; color: #c9d1d9; }

    .task-priority {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      text-transform: uppercase;
    }

    .task-priority.high { background: rgba(248, 81, 73, 0.15); color: #f85149; }
    .task-priority.medium { background: rgba(210, 153, 34, 0.15); color: #d29922; }
    .task-priority.low { background: rgba(63, 185, 80, 0.15); color: #3fb950; }

    /* All Tasks Button */
    .all-tasks-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      margin-top: 0.75rem;
      padding: 0.625rem;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #8b949e;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .all-tasks-btn:hover {
      background: #30363d;
      color: #c9d1d9;
    }

    .all-tasks-btn svg {
      width: 16px;
      height: 16px;
      transition: transform 0.2s;
    }

    .all-tasks-btn.expanded svg {
      transform: rotate(180deg);
    }

    .all-tasks-panel {
      display: none;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #30363d;
    }

    .all-tasks-panel.show {
      display: block;
    }

    /* Progress Bars */
    .progress-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .progress-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .progress-label {
      width: 90px;
      font-size: 0.8rem;
      color: #8b949e;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .progress-percent {
      width: 36px;
      font-size: 0.8rem;
      color: #c9d1d9;
      text-align: right;
    }

    .progress-bar {
      flex: 1;
      height: 6px;
      background: #21262d;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s;
    }

    .progress-fill.green { background: #3fb950; }
    .progress-fill.blue { background: #58a6ff; }
    .progress-fill.pink { background: #f778ba; }
    .progress-fill.yellow { background: #d29922; }
    .progress-fill.purple { background: #a371f7; }

    /* Apps Grid */
    .apps-grid {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .app-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      text-decoration: none;
      color: #c9d1d9;
      transition: all 0.2s;
    }

    .app-link:hover {
      background: #30363d;
      border-color: #8b949e;
    }

    .app-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app-icon svg {
      width: 18px;
      height: 18px;
      color: #fff;
    }

    .app-name {
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Form */
    .form-group {
      margin-bottom: 0.875rem;
    }

    .form-group label {
      display: block;
      font-size: 0.75rem;
      color: #8b949e;
      margin-bottom: 0.375rem;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: #c9d1d9;
      font-size: 0.875rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #58a6ff;
    }

    .form-group textarea {
      min-height: 60px;
      resize: vertical;
    }

    .submit-btn {
      width: 100%;
      background: #238636;
      border: none;
      border-radius: 6px;
      padding: 0.625rem;
      color: #fff;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .submit-btn:hover {
      background: #2ea043;
    }

    .success-msg {
      background: rgba(63, 185, 80, 0.1);
      border: 1px solid rgba(63, 185, 80, 0.3);
      border-radius: 6px;
      padding: 0.625rem;
      color: #3fb950;
      font-size: 0.8rem;
      text-align: center;
      margin-top: 0.75rem;
      display: none;
    }

    .success-msg.show { display: block; }

    /* Span classes */
    .span-2 { grid-column: span 2; }
    .span-3 { grid-column: span 3; }

    @media (max-width: 1200px) {
      .span-2, .span-3 { grid-column: span 1; }
    }

    /* Health Stats */
    .health-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .health-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      padding: 0.25rem 0;
    }

    .health-label { color: #8b949e; }
    .health-value { color: #c9d1d9; font-weight: 500; }
    .health-value.positive { color: #3fb950; }
    .health-value.warning { color: #d29922; }
    .health-value.negative { color: #f85149; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-logo">H</div>
    <div class="sidebar-nav">
      <div class="nav-item active" title="Dashboard">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="3" y="14" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/>
        </svg>
      </div>
      <div class="nav-item" title="Tasks">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"/>
          <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
        </svg>
      </div>
      <div class="nav-item" title="Apps">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2"/>
          <path d="M8 21h8M12 17v4"/>
        </svg>
      </div>
      <div class="nav-item" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main">
    <header class="header">
      <div class="header-top">
        <div class="header-left">
          <h1>Henry Dashboard</h1>
          <span class="status-badge">Online</span>
        </div>
      </div>
      <div class="header-right" id="lastUpdated">Last updated: --</div>
    </header>

    <!-- Current Task Banner -->
    <div class="current-task-banner" id="currentTaskBanner">
      <div class="current-task-label" id="currentTaskLabel">Current Task</div>
      <div id="currentTaskContent">
        <p class="no-current-task">No task in progress</p>
      </div>
    </div>

    <div class="grid">
      <!-- Next Task -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Next Task</span>
        </div>
        <div id="nextTaskContent">
          <p class="no-current-task" style="font-size: 0.8rem;">No pending tasks</p>
        </div>
      </div>

      <!-- Recurring Tasks -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Recurring Tasks</span>
        </div>
        <div class="recurring-list">
          <div class="recurring-item">
            <div class="recurring-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
            </div>
            <div class="recurring-info">
              <div class="recurring-title">Morning Report</div>
              <div class="recurring-desc">Daily briefing for Louis</div>
            </div>
            <div class="recurring-badge">Daily</div>
          </div>
          <div class="recurring-item">
            <div class="recurring-icon" style="background: rgba(236, 72, 153, 0.15);">
              <svg viewBox="0 0 24 24" fill="none" stroke="#ec4899" stroke-width="2">
                <rect x="2" y="2" width="20" height="20" rx="5"/>
                <circle cx="12" cy="12" r="4"/>
                <circle cx="18" cy="6" r="1.5" fill="#ec4899"/>
              </svg>
            </div>
            <div class="recurring-info">
              <div class="recurring-title">Instagram Follow Session</div>
              <div class="recurring-desc">Follow target accounts for eddytrains</div>
            </div>
            <div class="recurring-badge">2x Daily</div>
          </div>
        </div>
        <button class="all-tasks-btn" id="allTasksBtn" onclick="toggleAllTasks()">
          <span>All Tasks</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="allTasksArrow">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="all-tasks-panel" id="allTasksPanel">
          <div class="task-list" id="allTasksList"></div>
        </div>
      </div>

      <!-- Workload -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Workload</span>
        </div>
        <div class="progress-list" id="workloadList"></div>
      </div>

      <!-- Recommendations -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Recommended Actions</span>
        </div>
        <div class="rec-list" id="recsList">
          <p class="no-current-task" style="font-size: 0.8rem;">No recommendations</p>
        </div>
      </div>

      <!-- Apps -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Apps</span>
        </div>
        <div class="apps-grid">
          <a href="https://henryworkshard.github.io/eddytrains-content-planner/" target="_blank" class="app-link">
            <div class="app-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2"/>
                <path d="M16 2v4M8 2v4M3 10h18"/>
              </svg>
            </div>
            <span class="app-name">Content Planner</span>
          </a>
          <a href="https://henryworkshard.github.io/henry-dashboard/" target="_blank" class="app-link">
            <div class="app-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/>
                <rect x="14" y="14" width="7" height="7" rx="1"/>
              </svg>
            </div>
            <span class="app-name">Dashboard</span>
          </a>
        </div>
      </div>

      <!-- All Tasks -->
      <div class="card span-2">
        <div class="card-header">
          <span class="card-title">All Tasks</span>
        </div>
        <div class="task-list" id="taskList"></div>
      </div>

      <!-- Assign Task -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Assign Task</span>
        </div>
        <form id="assignForm">
          <div class="form-group">
            <label for="taskTitle">Title</label>
            <input type="text" id="taskTitle" name="title" placeholder="Task name" required>
          </div>
          <div class="form-group">
            <label for="taskDesc">Description</label>
            <textarea id="taskDesc" name="description" placeholder="Details..."></textarea>
          </div>
          <div class="form-group">
            <label for="taskPriority">Priority</label>
            <select id="taskPriority" name="priority">
              <option value="high">High</option>
              <option value="medium" selected>Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <button type="submit" class="submit-btn">Assign Task</button>
          <div class="success-msg" id="successMsg">Task assigned successfully</div>
        </form>
      </div>
    </div>
  </main>

  <script>
    async function loadData() {
      try {
        const [tasksRes, recsRes] = await Promise.all([
          fetch('data/tasks.json'),
          fetch('data/recommendations.json')
        ]);
        
        const tasks = await tasksRes.json();
        const recs = await recsRes.json();
        
        // Calculate stats
        const allTasks = tasks.tasks || [];
        const completed = allTasks.filter(t => t.status === 'completed').length;
        const inProgress = allTasks.filter(t => t.status === 'in_progress').length;
        const pending = allTasks.filter(t => t.status === 'pending').length;
        const overdue = allTasks.filter(t => t.status === 'overdue').length;
        const total = allTasks.length;

        // Current Task
        const currentTaskBanner = document.getElementById('currentTaskBanner');
        const currentTaskContent = document.getElementById('currentTaskContent');
        const currentTaskLabel = document.getElementById('currentTaskLabel');
        const isPaused = tasks.inProgress?.paused || false;
        
        // Update paused state
        if (isPaused) {
          currentTaskBanner.classList.add('paused');
          currentTaskLabel.innerHTML = 'Current Task <span class="paused-badge"><svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg>Paused</span>';
        } else {
          currentTaskBanner.classList.remove('paused');
          currentTaskLabel.textContent = 'Current Task';
        }
        
        if (tasks.inProgress) {
          currentTaskContent.innerHTML = `
            <div class="current-task-title">${tasks.inProgress.title}</div>
            <div class="current-task-desc">${tasks.inProgress.description}</div>
            <div class="current-task-progress">${tasks.inProgress.progress}</div>
          `;
        } else {
          const inProgressTask = allTasks.find(t => t.status === 'in_progress');
          if (inProgressTask) {
            currentTaskContent.innerHTML = `
              <div class="current-task-title">${inProgressTask.title}</div>
              <div class="current-task-desc">${inProgressTask.description || ''}</div>
            `;
          } else {
            currentTaskContent.innerHTML = '<p class="no-current-task">No task in progress</p>';
          }
        }

        // Next Task
        const nextTaskContent = document.getElementById('nextTaskContent');
        const nextTask = allTasks.find(t => t.status === 'pending');
        if (nextTask) {
          nextTaskContent.innerHTML = `
            <div class="next-task-item">
              <div class="next-task-title">${nextTask.title}</div>
              <div class="next-task-desc">${nextTask.description || ''}</div>
              <div class="next-task-meta">
                <span class="meta-tag ${nextTask.priority}">${nextTask.priority}</span>
                ${nextTask.due ? `<span class="meta-tag">Due: ${nextTask.due}</span>` : ''}
              </div>
            </div>
          `;
        } else {
          nextTaskContent.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">No pending tasks</p>';
        }

        // Workload (by priority)
        const highCount = allTasks.filter(t => t.priority === 'high' && t.status !== 'completed').length;
        const medCount = allTasks.filter(t => t.priority === 'medium' && t.status !== 'completed').length;
        const lowCount = allTasks.filter(t => t.priority === 'low' && t.status !== 'completed').length;
        const maxCount = Math.max(highCount, medCount, lowCount, 1);

        document.getElementById('workloadList').innerHTML = `
          <div class="progress-row">
            <span class="progress-label">High</span>
            <span class="progress-percent">${highCount}</span>
            <div class="progress-bar">
              <div class="progress-fill pink" style="width: ${(highCount/maxCount)*100}%"></div>
            </div>
          </div>
          <div class="progress-row">
            <span class="progress-label">Medium</span>
            <span class="progress-percent">${medCount}</span>
            <div class="progress-bar">
              <div class="progress-fill yellow" style="width: ${(medCount/maxCount)*100}%"></div>
            </div>
          </div>
          <div class="progress-row">
            <span class="progress-label">Low</span>
            <span class="progress-percent">${lowCount}</span>
            <div class="progress-bar">
              <div class="progress-fill green" style="width: ${(lowCount/maxCount)*100}%"></div>
            </div>
          </div>
        `;

        // Recommendations
        const recsList = document.getElementById('recsList');
        const recommendations = recs.recommendations || [];
        if (recommendations.length > 0) {
          recsList.innerHTML = recommendations.slice(0, 3).map(rec => `
            <div class="rec-item">
              <div class="rec-title">${rec.title}</div>
              <div class="rec-desc">${rec.description}</div>
              <span class="rec-category">${rec.category}</span>
            </div>
          `).join('');
        } else {
          recsList.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">No recommendations</p>';
        }

        // Task list (recent)
        const taskList = document.getElementById('taskList');
        if (allTasks.length > 0) {
          taskList.innerHTML = allTasks.slice(0, 6).map(task => `
            <div class="task-item">
              <div class="task-status ${task.status}"></div>
              <span class="task-name">${task.title}</span>
              <span class="task-priority ${task.priority}">${task.priority}</span>
            </div>
          `).join('');
        } else {
          taskList.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">No tasks</p>';
        }

        // All Tasks list (for expandable panel)
        const allTasksList = document.getElementById('allTasksList');
        if (allTasks.length > 0) {
          allTasksList.innerHTML = allTasks.map(task => `
            <div class="task-item">
              <div class="task-status ${task.status}"></div>
              <span class="task-name">${task.title}</span>
              <span class="task-priority ${task.priority}">${task.priority}</span>
            </div>
          `).join('');
        } else {
          allTasksList.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">No tasks assigned yet</p>';
        }
        
        document.getElementById('lastUpdated').textContent = 
          'Last updated: ' + new Date(tasks.lastUpdated).toLocaleString();
      } catch (err) {
        console.error('Error loading data:', err);
      }
    }

    document.getElementById('assignForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = {
        id: 'assign-' + Date.now(),
        title: form.title.value,
        description: form.description.value,
        priority: form.priority.value,
        submitted: new Date().toISOString(),
        status: 'pending'
      };
      
      localStorage.setItem('henry-pending-' + data.id, JSON.stringify(data));
      document.getElementById('successMsg').classList.add('show');
      form.reset();
      setTimeout(() => {
        document.getElementById('successMsg').classList.remove('show');
      }, 3000);
    });

    // Toggle All Tasks panel
    function toggleAllTasks() {
      const btn = document.getElementById('allTasksBtn');
      const panel = document.getElementById('allTasksPanel');
      btn.classList.toggle('expanded');
      panel.classList.toggle('show');
    }

    loadData();
    setInterval(loadData, 60000);

    // Service Worker for auto-updates
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        reg.update();
        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'activated') {
              window.location.reload();
            }
          });
        });
      });
      
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          navigator.serviceWorker.getRegistration().then(reg => {
            if (reg) reg.update();
          });
        }
      });
    }
  </script>
</body>
</html>
