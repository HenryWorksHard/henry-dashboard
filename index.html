<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0d1117">
  <link rel="manifest" href="manifest.json">
  <title>Henry Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0d1117;
      min-height: 100vh;
      color: #c9d1d9;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 60px;
      background: #161b22;
      border-right: 1px solid #30363d;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
      gap: 1.5rem;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
    }

    .sidebar-logo {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      font-size: 1rem;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .nav-item {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8b949e;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-item:hover, .nav-item.active {
      background: #21262d;
      color: #c9d1d9;
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
    }

    /* Main Content */
    .main {
      flex: 1;
      padding: 1.5rem 2rem;
      overflow-y: auto;
      margin-left: 60px;
    }

    .header {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #30363d;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #f0f6fc;
    }

    .status-badge {
      background: #238636;
      color: #fff;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .header-right {
      color: #8b949e;
      font-size: 0.75rem;
    }

    .weekly-stats {
      display: flex;
      gap: 1rem;
    }

    .stat-item {
      font-size: 0.8rem;
      color: #8b949e;
      background: #21262d;
      padding: 0.375rem 0.75rem;
      border-radius: 20px;
    }

    .stat-item strong {
      color: #3fb950;
    }

    @media (max-width: 768px) {
      .header-top {
        flex-direction: column;
        align-items: flex-start;
      }
      .weekly-stats {
        margin-top: 0.5rem;
      }
    }

    /* Current Task Banner */
    .current-task-banner {
      background: linear-gradient(135deg, rgba(88, 166, 255, 0.1) 0%, rgba(56, 139, 253, 0.1) 100%);
      border: 1px solid rgba(88, 166, 255, 0.4);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .current-task-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #58a6ff, #388bfd);
    }

    .current-task-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #58a6ff;
      margin-bottom: 0.5rem;
    }

    .current-task-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #f0f6fc;
      margin-bottom: 0.25rem;
    }

    .current-task-desc {
      font-size: 0.875rem;
      color: #8b949e;
      margin-bottom: 0.75rem;
    }

    .current-task-progress {
      font-size: 0.8rem;
      color: #58a6ff;
      background: rgba(88, 166, 255, 0.1);
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      display: inline-block;
    }

    .no-current-task {
      color: #8b949e;
      font-size: 0.875rem;
    }

    .up-next {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(88, 166, 255, 0.2);
    }

    .up-next-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #8b949e;
      margin-bottom: 0.375rem;
    }

    .up-next-content {
      font-size: 0.875rem;
      color: #c9d1d9;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .up-next-content .meta-tag {
      font-size: 0.7rem;
    }

    /* Paused State */
    .current-task-banner.paused {
      background: linear-gradient(135deg, rgba(210, 153, 34, 0.1) 0%, rgba(210, 153, 34, 0.05) 100%);
      border-color: rgba(210, 153, 34, 0.4);
    }

    .current-task-banner.paused::before {
      background: #d29922;
      animation: none;
    }

    .current-task-banner.paused .current-task-label {
      color: #d29922;
    }

    .paused-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      background: rgba(210, 153, 34, 0.15);
      color: #d29922;
      padding: 0.25rem 0.625rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-left: 0.5rem;
    }

    .paused-badge svg {
      width: 12px;
      height: 12px;
    }

    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    @media (max-width: 1200px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      .sidebar { display: none; }
      .main { margin-left: 0; }
    }

    /* Cards */
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 1.25rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #f0f6fc;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
      color: #8b949e;
    }

    .card-actions svg {
      width: 16px;
      height: 16px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .card-actions svg:hover {
      color: #c9d1d9;
    }

    /* Next Task Card */
    .next-task-item {
      background: #21262d;
      border-radius: 6px;
      padding: 1rem;
    }

    .next-task-item.clickable {
      cursor: pointer;
      transition: background 0.2s;
    }

    .next-task-item.clickable:hover {
      background: #30363d;
    }

    .next-task-title {
      font-weight: 500;
      color: #f0f6fc;
      margin-bottom: 0.25rem;
    }

    .next-task-desc {
      font-size: 0.8rem;
      color: #8b949e;
      margin-bottom: 0.5rem;
    }

    .next-task-meta {
      display: flex;
      gap: 0.75rem;
      font-size: 0.75rem;
    }

    .meta-tag {
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: rgba(139, 148, 158, 0.1);
      color: #8b949e;
    }

    .meta-tag.high { background: rgba(248, 81, 73, 0.15); color: #f85149; }
    .meta-tag.medium { background: rgba(210, 153, 34, 0.15); color: #d29922; }
    .meta-tag.low { background: rgba(63, 185, 80, 0.15); color: #3fb950; }

    /* Recurring Tasks */
    .recurring-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .recurring-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: #21262d;
      border-radius: 6px;
    }

    .recurring-item.clickable {
      cursor: pointer;
      transition: background 0.2s;
    }

    .recurring-item.clickable:hover {
      background: #30363d;
    }

    .recurring-period {
      font-size: 0.7rem;
      color: #58a6ff;
      margin-top: 0.25rem;
    }

    .recurring-icon {
      width: 36px;
      height: 36px;
      border-radius: 6px;
      background: rgba(136, 46, 224, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .recurring-icon svg {
      width: 18px;
      height: 18px;
      color: #a371f7;
    }

    .recurring-info {
      flex: 1;
    }

    .recurring-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #f0f6fc;
    }

    .recurring-desc {
      font-size: 0.75rem;
      color: #8b949e;
    }

    .recurring-badge {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      background: rgba(163, 113, 247, 0.15);
      color: #a371f7;
    }

    /* Recommendations */
    .rec-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .rec-item {
      padding: 0.875rem;
      border-left: 3px solid #58a6ff;
      background: rgba(88, 166, 255, 0.05);
      border-radius: 0 6px 6px 0;
    }

    .rec-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #f0f6fc;
      margin-bottom: 0.25rem;
    }

    .rec-desc {
      font-size: 0.8rem;
      color: #8b949e;
      line-height: 1.4;
    }

    .rec-category {
      display: inline-block;
      margin-top: 0.5rem;
      font-size: 0.65rem;
      text-transform: uppercase;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      background: rgba(139, 148, 158, 0.1);
      color: #8b949e;
    }

    /* Task List */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .task-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: #21262d;
      border-radius: 6px;
      font-size: 0.875rem;
    }

    .task-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .task-status.completed { background: #3fb950; }
    .task-status.in_progress, .task-status.in-progress { background: #58a6ff; }
    .task-status.pending { background: #8b949e; }
    .task-status.overdue { background: #f85149; }

    .task-name { flex: 1; color: #c9d1d9; }

    .task-priority {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      text-transform: uppercase;
    }

    .task-priority.high { background: rgba(248, 81, 73, 0.15); color: #f85149; }
    .task-priority.medium { background: rgba(210, 153, 34, 0.15); color: #d29922; }
    .task-priority.low { background: rgba(63, 185, 80, 0.15); color: #3fb950; }

    /* All Tasks Button */
    .all-tasks-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      margin-top: 0.75rem;
      padding: 0.625rem;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #8b949e;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .all-tasks-btn:hover {
      background: #30363d;
      color: #c9d1d9;
    }

    .all-tasks-btn svg {
      width: 16px;
      height: 16px;
      transition: transform 0.2s;
    }

    .all-tasks-btn.expanded svg {
      transform: rotate(180deg);
    }

    .all-tasks-panel {
      display: none;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #30363d;
    }

    .all-tasks-panel.show {
      display: block;
    }

    /* Progress Bars */
    .progress-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .progress-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .progress-label {
      width: 90px;
      font-size: 0.8rem;
      color: #8b949e;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .progress-percent {
      width: 36px;
      font-size: 0.8rem;
      color: #c9d1d9;
      text-align: right;
    }

    .progress-bar {
      flex: 1;
      height: 6px;
      background: #21262d;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s;
    }

    .progress-fill.green { background: #3fb950; }
    .progress-fill.blue { background: #58a6ff; }
    .progress-fill.pink { background: #f778ba; }
    .progress-fill.yellow { background: #d29922; }
    .progress-fill.purple { background: #a371f7; }

    /* Apps Row */
    .apps-row {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-start;
    }

    .app-icon-link {
      width: 40px;
      height: 40px;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.2s;
    }

    .app-icon-link:hover {
      background: #30363d;
      border-color: #58a6ff;
      transform: translateY(-2px);
    }

    .app-icon-link svg {
      width: 20px;
      height: 20px;
      color: #8b949e;
    }

    .app-icon-link:hover svg {
      color: #58a6ff;
    }

    /* Floating Add Button */
    .fab-btn {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(35, 134, 54, 0.4);
      transition: all 0.2s;
      z-index: 50;
    }

    .fab-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(35, 134, 54, 0.5);
    }

    .fab-btn:active {
      transform: scale(0.95);
    }

    .fab-btn svg {
      width: 28px;
      height: 28px;
      color: #fff;
    }

    @media (max-width: 768px) {
      .fab-btn {
        display: none;
      }
    }

    /* Sticky Top Bar */
    .sticky-bar {
      position: fixed;
      top: 0;
      left: 60px;
      right: 0;
      height: 56px;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      padding: 0 1rem;
      z-index: 90;
      pointer-events: none;
    }

    .sticky-bar > * {
      pointer-events: auto;
    }

    .sticky-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 2px solid #30363d;
      background: #21262d;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .sticky-btn:hover {
      border-color: #58a6ff;
      transform: scale(1.05);
    }

    .sticky-btn svg {
      width: 20px;
      height: 20px;
      color: #8b949e;
    }

    .sticky-btn:hover svg {
      color: #58a6ff;
    }

    .sticky-btn.primary {
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      border-color: #238636;
      width: 48px;
      height: 48px;
    }

    .sticky-btn.primary svg {
      width: 24px;
      height: 24px;
      color: #fff;
    }

    .sticky-btn.primary:hover {
      border-color: #3fb950;
    }

    .sticky-btn.avatar {
      padding: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #58a6ff 0%, #388bfd 100%);
    }

    .sticky-btn.avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .sticky-btn.avatar .avatar-letter {
      font-size: 1.25rem;
      font-weight: 700;
      color: #fff;
    }

    @media (max-width: 768px) {
      .sticky-bar {
        left: 0;
      }
    }

    /* Form */
    .form-group {
      margin-bottom: 0.875rem;
    }

    .form-group label {
      display: block;
      font-size: 0.75rem;
      color: #8b949e;
      margin-bottom: 0.375rem;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: #c9d1d9;
      font-size: 0.875rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #58a6ff;
    }

    .form-group textarea {
      min-height: 60px;
      resize: vertical;
    }

    .toggle-group {
      display: flex;
      gap: 0;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid #30363d;
    }

    .toggle-btn {
      flex: 1;
      padding: 0.5rem;
      background: #0d1117;
      border: none;
      color: #8b949e;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .toggle-group.three .toggle-btn {
      border-right: 1px solid #30363d;
    }

    .toggle-group.three .toggle-btn:last-child {
      border-right: none;
    }

    .toggle-btn:first-child {
      border-right: 1px solid #30363d;
    }

    .toggle-btn.active {
      background: #238636;
      color: #fff;
    }

    .toggle-btn#toggleUrgent.active {
      background: #f85149;
    }

    .toggle-btn:hover:not(.active) {
      background: #21262d;
    }

    /* Completed List */
    .completed-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .completed-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: rgba(63, 185, 80, 0.1);
      border-radius: 6px;
      font-size: 0.8rem;
      color: #c9d1d9;
    }

    .completed-item svg {
      width: 14px;
      height: 14px;
      color: #3fb950;
      flex-shrink: 0;
    }

    .completed-time {
      margin-left: auto;
      font-size: 0.7rem;
      color: #8b949e;
    }

    .submit-btn {
      width: 100%;
      background: #238636;
      border: none;
      border-radius: 6px;
      padding: 0.625rem;
      color: #fff;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .submit-btn:hover {
      background: #2ea043;
    }

    .success-msg {
      background: rgba(63, 185, 80, 0.1);
      border: 1px solid rgba(63, 185, 80, 0.3);
      border-radius: 6px;
      padding: 0.625rem;
      color: #3fb950;
      font-size: 0.8rem;
      text-align: center;
      margin-top: 0.75rem;
      display: none;
    }

    .success-msg.show { display: block; }

    /* Task Detail Modal */
    .task-modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .task-modal-overlay.show {
      display: flex;
    }

    .task-modal {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .task-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid #30363d;
    }

    .task-modal-title {
      font-size: 1rem;
      font-weight: 600;
      color: #f0f6fc;
    }

    .task-modal-close {
      background: none;
      border: none;
      color: #8b949e;
      cursor: pointer;
      padding: 0.25rem;
    }

    .task-modal-close:hover {
      color: #f0f6fc;
    }

    .task-modal-body {
      padding: 1rem;
    }

    .task-detail-row {
      margin-bottom: 1rem;
    }

    .task-detail-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: #8b949e;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.375rem;
    }

    .task-detail-value {
      font-size: 0.875rem;
      color: #c9d1d9;
    }

    .task-subtasks {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .task-subtask {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: #c9d1d9;
    }

    .task-subtask.done {
      color: #8b949e;
      text-decoration: line-through;
    }

    .task-subtask-check {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid #30363d;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .task-subtask.done .task-subtask-check {
      background: #238636;
      border-color: #238636;
    }

    .task-subtask-check svg {
      width: 10px;
      height: 10px;
      color: #fff;
    }

    .task-modal-divider {
      height: 1px;
      background: #30363d;
      margin: 1rem 0;
    }

    .task-change-form {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .task-change-form textarea {
      width: 100%;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 0.625rem;
      color: #c9d1d9;
      font-size: 0.875rem;
      font-family: inherit;
      min-height: 80px;
      resize: vertical;
    }

    .task-change-form textarea:focus {
      outline: none;
      border-color: #58a6ff;
    }

    .task-item.clickable {
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-item.clickable:hover {
      background: #30363d;
    }

    /* Span classes */
    .span-2 { grid-column: span 2; }
    .span-3 { grid-column: span 3; }

    @media (max-width: 1200px) {
      .span-2, .span-3 { grid-column: span 1; }
    }

    /* Health Stats */
    .health-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .health-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      padding: 0.25rem 0;
    }

    .health-label { color: #8b949e; }
    .health-value { color: #c9d1d9; font-weight: 500; }
    .health-value.positive { color: #3fb950; }
    .health-value.warning { color: #d29922; }
    .health-value.negative { color: #f85149; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-logo">H</div>
    <div class="sidebar-nav">
      <div class="nav-item active" title="Dashboard">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="3" y="14" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/>
        </svg>
      </div>
      <div class="nav-item" title="Tasks">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"/>
          <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
        </svg>
      </div>
      <div class="nav-item" title="Apps">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2"/>
          <path d="M8 21h8M12 17v4"/>
        </svg>
      </div>
      <div class="nav-item" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
      </div>
    </div>
  </nav>

  <!-- Sticky Top Bar -->
  <div class="sticky-bar">
    <a href="https://henryworkshard.github.io/eddytrains-content-planner/" target="_blank" class="sticky-btn" title="Content Planner">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2"/>
        <path d="M16 2v4M8 2v4M3 10h18"/>
      </svg>
    </a>
    <button class="sticky-btn" onclick="openRecsModal()" title="Recommendations">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 16v-4M12 8h.01"/>
      </svg>
    </button>
    <button class="sticky-btn primary" onclick="openAssignModal()" title="Assign New Task">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M12 5v14M5 12h14"/>
      </svg>
    </button>
    <a href="https://t.me/claborbot" target="_blank" class="sticky-btn avatar" title="Chat with Henry">
      <img src="assets/henry-avatar.jpg" alt="Henry">
    </a>
  </div>

  <!-- Main Content -->
  <main class="main" style="padding-top: 4.5rem;">
    <header class="header">
      <div class="header-top">
        <div class="header-left">
          <h1 id="greeting">Good morning, Louis</h1>
          <span class="status-badge">Online</span>
        </div>
        <div class="weekly-stats" id="weeklyStats">
          <span class="stat-item"><strong id="weeklyCompleted">0</strong> completed this week</span>
        </div>
      </div>
      <div class="header-right" id="lastUpdated">Last updated: --</div>
    </header>

    <!-- Current Task Banner -->
    <div class="current-task-banner" id="currentTaskBanner">
      <div class="current-task-label" id="currentTaskLabel">Current Task</div>
      <div id="currentTaskContent">
        <p class="no-current-task">No task in progress</p>
      </div>
      <div class="up-next" id="upNextSection" style="display:none;">
        <div class="up-next-label">Up next</div>
        <div class="up-next-content" id="upNextContent"></div>
      </div>
    </div>

    <div class="grid">
      <!-- Recurring Tasks -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Recurring Tasks</span>
        </div>
        <div class="recurring-list">
          <div class="recurring-item clickable" onclick="openTaskModal('recurring-morning')">
            <div class="recurring-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
            </div>
            <div class="recurring-info">
              <div class="recurring-title">Morning Report</div>
              <div class="recurring-desc">Daily briefing for Louis</div>
              <div class="recurring-period">Every day at 8:00 AM</div>
            </div>
            <div class="recurring-badge">Daily</div>
          </div>
          <div class="recurring-item clickable" onclick="openTaskModal('recurring-follow')">
            <div class="recurring-icon" style="background: rgba(236, 72, 153, 0.15);">
              <svg viewBox="0 0 24 24" fill="none" stroke="#ec4899" stroke-width="2">
                <rect x="2" y="2" width="20" height="20" rx="5"/>
                <circle cx="12" cy="12" r="4"/>
                <circle cx="18" cy="6" r="1.5" fill="#ec4899"/>
              </svg>
            </div>
            <div class="recurring-info">
              <div class="recurring-title">Instagram Follow Session</div>
              <div class="recurring-desc">Follow target accounts for eddytrains</div>
              <div class="recurring-period">12:00 PM and 6:00 PM</div>
            </div>
            <div class="recurring-badge">2x Daily</div>
          </div>
        </div>
        <button class="all-tasks-btn" id="allTasksBtn" onclick="toggleAllTasks()">
          <span>All Tasks</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="allTasksArrow">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="all-tasks-panel" id="allTasksPanel">
          <div class="task-list" id="allTasksList"></div>
        </div>
      </div>

      <!-- Completed Today -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Completed Today</span>
        </div>
        <div class="completed-list" id="completedList">
          <p class="no-current-task" style="font-size: 0.8rem;">Nothing completed yet</p>
        </div>
      </div>

    </div>
  </main>

  <!-- Floating Add Button -->
  <button class="fab-btn" onclick="openAssignModal()" title="Assign New Task">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="M12 5v14M5 12h14"/>
    </svg>
  </button>

  <!-- Task Detail Modal -->
  <div class="task-modal-overlay" id="taskModal">
    <div class="task-modal">
      <div class="task-modal-header">
        <span class="task-modal-title" id="modalTaskTitle">Task Details</span>
        <button class="task-modal-close" onclick="closeTaskModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="task-modal-body">
        <div id="modalTaskContent"></div>
        
        <div class="task-modal-divider"></div>
        
        <div class="task-detail-label">Request Changes</div>
        <form class="task-change-form" id="taskChangeForm">
          <textarea id="taskChangeRequest" placeholder="Describe what you want changed, added, or removed..."></textarea>
          <button type="submit" class="submit-btn">Send to Henry</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Recommendations Modal -->
  <div class="task-modal-overlay" id="recsModal">
    <div class="task-modal">
      <div class="task-modal-header">
        <span class="task-modal-title">Recommendations</span>
        <button class="task-modal-close" onclick="closeRecsModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="task-modal-body">
        <div class="rec-list" id="recsModalList">
          <p class="no-current-task" style="font-size: 0.8rem;">No recommendations</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Assign Task Modal -->
  <div class="task-modal-overlay" id="assignModal">
    <div class="task-modal">
      <div class="task-modal-header">
        <span class="task-modal-title">Assign Task</span>
        <button class="task-modal-close" onclick="closeAssignModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="task-modal-body">
        <form id="assignForm">
          <div class="form-group">
            <label for="taskTitle">Title</label>
            <input type="text" id="taskTitle" name="title" placeholder="Task name" required>
          </div>
          <div class="form-group">
            <label for="taskDesc">Description</label>
            <textarea id="taskDesc" name="description" placeholder="Details..."></textarea>
          </div>
          <div class="form-group">
            <label for="taskPriority">Priority</label>
            <select id="taskPriority" name="priority">
              <option value="high">High</option>
              <option value="medium" selected>Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <div class="form-group">
            <label>When</label>
            <div class="toggle-group three">
              <button type="button" class="toggle-btn active" id="toggleNext" onclick="setSchedule('next')">Next</button>
              <button type="button" class="toggle-btn" id="toggleUrgent" onclick="setSchedule('urgent')">Urgent</button>
              <button type="button" class="toggle-btn" id="toggleScheduled" onclick="setSchedule('scheduled')">Scheduled</button>
            </div>
            <input type="hidden" id="taskSchedule" value="next">
          </div>
          <button type="submit" class="submit-btn">Send to Henry</button>
          <div class="success-msg" id="successMsg">Opening Telegram...</div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Global tasks data for modal access
    let globalTasksData = { tasks: [], inProgress: null };
    let globalRecsData = [];

    // Set greeting based on time
    function updateGreeting() {
      const hour = new Date().getHours();
      let greeting;
      if (hour < 12) greeting = 'Good morning, Louis';
      else if (hour < 17) greeting = 'Good afternoon, Louis';
      else greeting = 'Good evening, Louis';
      document.getElementById('greeting').textContent = greeting;
    }

    // Recommendations modal
    function openRecsModal() {
      const recsList = document.getElementById('recsModalList');
      if (globalRecsData.length > 0) {
        recsList.innerHTML = globalRecsData.map(rec => `
          <div class="rec-item">
            <div class="rec-title">${rec.title}</div>
            <div class="rec-desc">${rec.description}</div>
            <span class="rec-category">${rec.category}</span>
          </div>
        `).join('');
      } else {
        recsList.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">No recommendations yet</p>';
      }
      document.getElementById('recsModal').classList.add('show');
    }

    function closeRecsModal() {
      document.getElementById('recsModal').classList.remove('show');
    }

    // Close recs modal on overlay click
    document.getElementById('recsModal').addEventListener('click', (e) => {
      if (e.target.id === 'recsModal') closeRecsModal();
    });

    async function loadData() {
      try {
        const [tasksRes, recsRes] = await Promise.all([
          fetch('data/tasks.json'),
          fetch('data/recommendations.json')
        ]);
        
        const tasks = await tasksRes.json();
        const recs = await recsRes.json();
        
        // Store globally for modal access
        globalTasksData = tasks;
        globalRecsData = recs.recommendations || [];
        
        // Update greeting
        updateGreeting();
        
        // Calculate stats
        const allTasks = tasks.tasks || [];
        const completed = allTasks.filter(t => t.status === 'completed').length;
        const inProgress = allTasks.filter(t => t.status === 'in_progress').length;
        const pending = allTasks.filter(t => t.status === 'pending').length;
        const overdue = allTasks.filter(t => t.status === 'overdue').length;
        const total = allTasks.length;
        
        // Weekly stats (completed this week from completedToday + tasks with completedDate in last 7 days)
        const weeklyCompleted = (tasks.completedToday?.length || 0) + (tasks.weeklyCompleted || 0);
        document.getElementById('weeklyCompleted').textContent = weeklyCompleted;

        // Current Task
        const currentTaskBanner = document.getElementById('currentTaskBanner');
        const currentTaskContent = document.getElementById('currentTaskContent');
        const currentTaskLabel = document.getElementById('currentTaskLabel');
        const isPaused = tasks.inProgress?.paused || false;
        
        // Update paused state
        if (isPaused) {
          currentTaskBanner.classList.add('paused');
          currentTaskLabel.innerHTML = 'Current Task <span class="paused-badge"><svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg>Paused</span>';
        } else {
          currentTaskBanner.classList.remove('paused');
          currentTaskLabel.textContent = 'Current Task';
        }
        
        // Up Next section
        const upNextSection = document.getElementById('upNextSection');
        const upNextContent = document.getElementById('upNextContent');
        
        if (tasks.inProgress) {
          currentTaskBanner.style.cursor = 'pointer';
          currentTaskBanner.onclick = () => openTaskModal('inProgress');
          currentTaskContent.innerHTML = `
            <div class="current-task-title">${tasks.inProgress.title}</div>
            <div class="current-task-desc">${tasks.inProgress.description}</div>
            <div class="current-task-progress">${tasks.inProgress.progress}</div>
          `;
        } else {
          const inProgressTask = allTasks.find(t => t.status === 'in_progress');
          if (inProgressTask) {
            currentTaskBanner.style.cursor = 'pointer';
            currentTaskBanner.onclick = () => openTaskModal(inProgressTask.id);
            currentTaskContent.innerHTML = `
              <div class="current-task-title">${inProgressTask.title}</div>
              <div class="current-task-desc">${inProgressTask.description || ''}</div>
            `;
          } else {
            currentTaskBanner.style.cursor = 'default';
            currentTaskBanner.onclick = null;
            currentTaskContent.innerHTML = '<p class="no-current-task">No task in progress</p>';
          }
        }

        // Show "Up next" in banner
        if (tasks.nextTask) {
          upNextSection.style.display = 'block';
          upNextContent.innerHTML = `
            <span>${tasks.nextTask.title}</span>
            ${tasks.nextTask.scheduledTime ? `<span class="meta-tag">${tasks.nextTask.scheduledTime}</span>` : ''}
            ${tasks.nextTask.type ? `<span class="meta-tag">${tasks.nextTask.type}</span>` : ''}
          `;
        } else {
          const pendingTask = allTasks.find(t => t.status === 'pending');
          if (pendingTask) {
            upNextSection.style.display = 'block';
            upNextContent.innerHTML = `
              <span>${pendingTask.title}</span>
              <span class="meta-tag ${pendingTask.priority}">${pendingTask.priority}</span>
            `;
          } else {
            upNextSection.style.display = 'none';
          }
        }

        // Completed Today
        const completedList = document.getElementById('completedList');
        const completedToday = tasks.completedToday || [];
        if (completedToday.length > 0) {
          completedList.innerHTML = completedToday.map(item => `
            <div class="completed-item">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              <span>${item.title}</span>
              <span class="completed-time">${item.time}</span>
            </div>
          `).join('');
        } else {
          completedList.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">Nothing completed yet</p>';
        }

        // All Tasks list (for expandable panel)
        const allTasksList = document.getElementById('allTasksList');
        if (allTasks.length > 0) {
          allTasksList.innerHTML = allTasks.map((task, i) => `
            <div class="task-item clickable" onclick="openTaskModal('${task.id}')">
              <div class="task-status ${task.status}"></div>
              <span class="task-name">${task.title}</span>
              <span class="task-priority ${task.priority}">${task.priority}</span>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" style="flex-shrink:0;">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </div>
          `).join('');
        } else {
          allTasksList.innerHTML = '<p class="no-current-task" style="font-size: 0.8rem;">No tasks assigned yet</p>';
        }
        
        document.getElementById('lastUpdated').textContent = 
          'Last updated: ' + new Date(tasks.lastUpdated).toLocaleString();
      } catch (err) {
        console.error('Error loading data:', err);
      }
    }

    // Assign Task Modal
    function openAssignModal() {
      document.getElementById('assignModal').classList.add('show');
      setTimeout(() => document.getElementById('taskTitle').focus(), 100);
    }

    function closeAssignModal() {
      document.getElementById('assignModal').classList.remove('show');
    }

    // Close assign modal on overlay click
    document.getElementById('assignModal').addEventListener('click', (e) => {
      if (e.target.id === 'assignModal') closeAssignModal();
    });

    // Task Modal Functions
    let currentModalTask = null;

    // Recurring tasks data (hardcoded since they're static)
    const recurringTasksData = {
      'recurring-morning': {
        id: 'recurring-morning',
        title: 'Morning Report',
        description: 'Daily briefing for Louis with yesterday\'s activity summary, follower changes, and recommendations for the day.',
        status: 'recurring',
        frequency: 'Daily',
        scheduledTime: '8:00 AM',
        type: 'recurring'
      },
      'recurring-follow': {
        id: 'recurring-follow',
        title: 'Instagram Follow Session',
        description: 'Follow target accounts for eddytrains growth. Focus on fitness/gym niche accounts with engaged audiences.',
        status: 'recurring',
        frequency: '2x Daily',
        scheduledTime: '12:00 PM and 6:00 PM',
        type: 'recurring'
      }
    };

    function openTaskModal(taskId) {
      let task;
      
      // Handle special task IDs
      if (taskId === 'inProgress') {
        task = globalTasksData.inProgress;
      } else if (taskId === 'nextTask') {
        task = globalTasksData.nextTask;
      } else if (taskId.startsWith('recurring-')) {
        task = recurringTasksData[taskId];
      } else {
        task = globalTasksData.tasks.find(t => t.id === taskId);
      }
      
      if (!task) return;
      
      currentModalTask = task;
      document.getElementById('modalTaskTitle').textContent = task.title;
      
      const statusColors = {
        'completed': '#3fb950',
        'in_progress': '#58a6ff',
        'pending': '#8b949e',
        'ongoing': '#a371f7',
        'overdue': '#f85149'
      };
      
      let content = '';
      
      // Handle recurring tasks differently
      if (task.status === 'recurring') {
        content += `
          <div class="task-detail-row">
            <div class="task-detail-label">Type</div>
            <div class="task-detail-value">
              <span style="display:inline-flex;align-items:center;gap:6px;">
                <span style="width:8px;height:8px;border-radius:50%;background:#a371f7"></span>
                Recurring Task
              </span>
            </div>
          </div>
          <div class="task-detail-row">
            <div class="task-detail-label">Frequency</div>
            <div class="task-detail-value">${task.frequency}</div>
          </div>
          <div class="task-detail-row">
            <div class="task-detail-label">Scheduled Time</div>
            <div class="task-detail-value">${task.scheduledTime}</div>
          </div>
        `;
      } else {
        content += `
          <div class="task-detail-row">
            <div class="task-detail-label">Status</div>
            <div class="task-detail-value">
              <span style="display:inline-flex;align-items:center;gap:6px;">
                <span style="width:8px;height:8px;border-radius:50%;background:${statusColors[task.status] || '#8b949e'}"></span>
                ${(task.status || 'pending').replace('_', ' ')}
              </span>
            </div>
          </div>
        `;
        if (task.priority) {
          content += `
            <div class="task-detail-row">
              <div class="task-detail-label">Priority</div>
              <div class="task-detail-value">${task.priority}</div>
            </div>
          `;
        }
      }
      
      if (task.description) {
        content += `
          <div class="task-detail-row">
            <div class="task-detail-label">Description</div>
            <div class="task-detail-value">${task.description}</div>
          </div>
        `;
      }
      
      if (task.due) {
        content += `
          <div class="task-detail-row">
            <div class="task-detail-label">Due Date</div>
            <div class="task-detail-value">${task.due}</div>
          </div>
        `;
      }
      
      if (task.subtasks && task.subtasks.length > 0) {
        content += `
          <div class="task-detail-row">
            <div class="task-detail-label">Requirements / Subtasks</div>
            <div class="task-subtasks">
              ${task.subtasks.map(st => `
                <div class="task-subtask ${st.done ? 'done' : ''}">
                  <div class="task-subtask-check">
                    ${st.done ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>' : ''}
                  </div>
                  <span>${st.title}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      document.getElementById('modalTaskContent').innerHTML = content;
      document.getElementById('taskModal').classList.add('show');
      document.getElementById('taskChangeRequest').value = '';
    }

    function closeTaskModal() {
      document.getElementById('taskModal').classList.remove('show');
      currentModalTask = null;
    }

    // Close modal on overlay click
    document.getElementById('taskModal').addEventListener('click', (e) => {
      if (e.target.id === 'taskModal') closeTaskModal();
    });

    // Task change request form
    document.getElementById('taskChangeForm').addEventListener('submit', (e) => {
      e.preventDefault();
      if (!currentModalTask) return;
      
      const changeRequest = document.getElementById('taskChangeRequest').value;
      if (!changeRequest.trim()) return;
      
      const message = `ðŸ“ TASK CHANGE REQUEST\n\nTask: ${currentModalTask.title}\nStatus: ${currentModalTask.status}\nPriority: ${currentModalTask.priority}\n\nRequested Changes:\n${changeRequest}`;
      
      const telegramUrl = `https://t.me/claborbot?text=${encodeURIComponent(message)}`;
      window.open(telegramUrl, '_blank');
      
      closeTaskModal();
    });

    function setSchedule(value) {
      document.getElementById('taskSchedule').value = value;
      document.getElementById('toggleNext').classList.toggle('active', value === 'next');
      document.getElementById('toggleUrgent').classList.toggle('active', value === 'urgent');
      document.getElementById('toggleScheduled').classList.toggle('active', value === 'scheduled');
    }

    document.getElementById('assignForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const title = form.title.value;
      const desc = form.description.value;
      const priority = form.priority.value;
      const schedule = document.getElementById('taskSchedule').value;
      
      // Build message for Henry
      let scheduleText;
      let scheduleEmoji;
      if (schedule === 'urgent') {
        scheduleText = 'URGENT - Interrupt current task';
        scheduleEmoji = 'ðŸš¨';
      } else if (schedule === 'next') {
        scheduleText = 'Next - After current task';
        scheduleEmoji = 'â­ï¸';
      } else {
        scheduleText = 'Scheduled - Add to queue';
        scheduleEmoji = 'ðŸ“…';
      }
      
      const priorityEmoji = priority === 'high' ? 'ðŸ”´' : priority === 'medium' ? 'ðŸŸ¡' : 'ðŸŸ¢';
      const message = `ðŸ“‹ NEW TASK\n\n${scheduleEmoji} ${scheduleText}\n\nTitle: ${title}\nPriority: ${priorityEmoji} ${priority}${desc ? '\n\nDetails: ' + desc : ''}`;
      
      // Open Telegram with pre-filled message
      const telegramUrl = `https://t.me/claborbot?text=${encodeURIComponent(message)}`;
      
      document.getElementById('successMsg').classList.add('show');
      
      // Open Telegram
      window.open(telegramUrl, '_blank');
      
      form.reset();
      setSchedule('next');
      
      setTimeout(() => {
        document.getElementById('successMsg').classList.remove('show');
        closeAssignModal();
      }, 1500);
    });

    // Toggle All Tasks panel
    function toggleAllTasks() {
      const btn = document.getElementById('allTasksBtn');
      const panel = document.getElementById('allTasksPanel');
      btn.classList.toggle('expanded');
      panel.classList.toggle('show');
    }

    loadData();
    setInterval(loadData, 60000);

    // Service Worker for auto-updates
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        reg.update();
        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'activated') {
              window.location.reload();
            }
          });
        });
      });
      
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          navigator.serviceWorker.getRegistration().then(reg => {
            if (reg) reg.update();
          });
        }
      });
    }
  </script>
</body>
</html>
